{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Crear Contrato</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background-color: #f9f9f9; padding-top: 40px; }
    .container { max-width: 960px; }
    .form-card {
      background-color: #fff;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.05);
      padding: 30px;
    }
    .form-title {
      font-size: 1.5rem;
      font-weight: bold;
      margin-bottom: 1.5rem;
      color: #0d6efd;
    }
    .summary-box {
      background-color: #f1f3f5;
      border-radius: 6px;
      padding: 15px;
      font-size: 0.95rem;
    }
    .summary-box h6 {
      font-weight: bold;
      margin-bottom: 10px;
    }
    .summary-box .row + .row {
      margin-top: 8px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="form-card mx-auto">
      <div class="form-title">üìÑ Crear Contrato de Cami√≥n</div>

      <form method="post">
        {% csrf_token %}
        <div class="row g-4">
          <div class="col-md-8">
            <div class="row g-3">
              {% for field in form %}
                <div class="col-md-6">
                  <label for="{{ field.id_for_label }}" class="form-label">{{ field.label }}</label>
                  {{ field }}
                  {% if field.errors %}
                    <div class="text-danger small mt-1">{{ field.errors }}</div>
                  {% endif %}
                </div>
              {% endfor %}
              <div class="col-md-6">
                <label class="form-label">Orden de Compra</label>
                <input type="text" class="form-control" value="(autom√°tica)" disabled>
              </div>
            </div>
          </div>

          <div class="col-md-4">
            <div class="summary-box">
              <h6>üßÆ C√°lculo Autom√°tico</h6>
              <div class="row">
                <div class="col-7">Valor Total:</div>
                <div class="col-5 text-end" id="valor_total">$0</div>
              </div>
              <div class="row">
                <div class="col-7">D√≠as Arriendo:</div>
                <div class="col-5 text-end" id="dias_arriendo">0</div>
              </div>
              <div class="row">
                <div class="col-7">Valor por D√≠a:</div>
                <div class="col-5 text-end" id="valor_dia">$0</div>
              </div>
            </div>
          </div>
        </div>

        <div class="mt-4">
          <button type="submit" class="btn btn-primary">üíæ Guardar Contrato</button>
          <a href="{% url 'dashboard_camion' %}" class="btn btn-outline-secondary">‚ùå Cancelar</a>
        </div>
      </form>
    </div>
  </div>

  <script>
    function calcularResumen() {
      const ufPactada = parseFloat(document.getElementById('id_uf_pactada')?.value) || 0;
      const ufDia = parseFloat(document.getElementById('id_uf_del_dia')?.value) || 0;
      const inicio = new Date(document.getElementById('id_fecha_inicio')?.value);
      const termino = new Date(document.getElementById('id_fecha_termino')?.value);

      const total = ufPactada * ufDia;
      const dias = (termino - inicio) / (1000 * 60 * 60 * 24) + 1;
      const valorDia = dias > 0 ? total / dias : 0;

      document.getElementById('valor_total').textContent = `$${total.toLocaleString('es-CL', {maximumFractionDigits: 0})}`;
      document.getElementById('dias_arriendo').textContent = dias > 0 ? dias : 0;
      document.getElementById('valor_dia').textContent = `$${valorDia.toLocaleString('es-CL', {maximumFractionDigits: 0})}`;
    }

    document.addEventListener('input', calcularResumen);
    document.addEventListener('change', calcularResumen);
  </script>
</body>
</html>